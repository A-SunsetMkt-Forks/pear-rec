import{C as he,r as s,a as ge,j as ye,c as Ee}from"./chunks/jsx-runtime.e49f5b19.js";import{f as _e,k as je,o as Be,c as Me,v as Te}from"./chunks/framework.8c65ee47.js";var ve={exports:{}},ee={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var me;function Ne(){if(me)return ee;me=1;var e=he,t=Symbol.for("react.element"),o=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function n(a,x,l){var u,d={},h=null,f=null;l!==void 0&&(h=""+l),x.key!==void 0&&(h=""+x.key),x.ref!==void 0&&(f=x.ref);for(u in x)c.call(x,u)&&!r.hasOwnProperty(u)&&(d[u]=x[u]);if(a&&a.defaultProps)for(u in x=a.defaultProps,x)d[u]===void 0&&(d[u]=x[u]);return{$$typeof:t,type:a,key:h,ref:f,props:d,_owner:i.current}}return ee.Fragment=o,ee.jsx=n,ee.jsxs=n,ee}ve.exports=Ne();var g=ve.exports,B=(e=>(e[e.Edit=0]="Edit",e[e.Source=1]="Source",e))(B||{});function se({image:e,width:t,height:o,history:c,bounds:i}){return new Promise((r,n)=>{const a=document.createElement("canvas"),x=i.width*window.devicePixelRatio,l=i.height*window.devicePixelRatio;a.width=x,a.height=l;const u=a.getContext("2d");if(!u)return n(new Error("convert image to blob fail"));const d=e.naturalWidth/t,h=e.naturalHeight/o;u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="low",u.setTransform(window.devicePixelRatio,0,0,window.devicePixelRatio,0,0),u.clearRect(0,0,i.width,i.height),u.drawImage(e,i.x*d,i.y*h,i.width*d,i.height*h,0,0,i.width,i.height),c.stack.slice(0,c.index+1).forEach(f=>{f.type===B.Source&&f.draw(u,f)}),a.toBlob(f=>{if(!f)return n(new Error("canvas toBlob fail"));r(f)},"image/png")})}const be={magnifier_position_label:"坐标",operation_ok_title:"确定",operation_cancel_title:"取消",operation_save_title:"保存",operation_redo_title:"重做",operation_undo_title:"撤销",operation_mosaic_title:"马赛克",operation_text_title:"文本",operation_brush_title:"画笔",operation_arrow_title:"箭头",operation_ellipse_title:"椭圆",operation_rectangle_title:"矩形"},fe=he.createContext({store:{url:void 0,image:null,width:0,height:0,lang:be,emiterRef:{current:{}},canvasContextRef:{current:null},history:{index:-1,stack:[]},bounds:null,cursor:"move",operation:void 0},dispatcher:{call:void 0,setHistory:void 0,setBounds:void 0,setCursor:void 0,setOperation:void 0}});function te(){const{dispatcher:e}=s.useContext(fe);return e}function L(){const{store:e}=s.useContext(fe);return e}function U(){const{bounds:e}=L(),{setBounds:t}=te(),o=s.useCallback(i=>{t==null||t(i)},[t]),c=s.useCallback(()=>{t==null||t(null)},[t]);return[e,{set:o,reset:c}]}function D(){const{lang:e}=L();return e}const I=100,V=80,Le=s.memo(function({x:e,y:t}){const{width:o,height:c,image:i}=L(),r=D(),[n,a]=s.useState(null),x=s.useRef(null),l=s.useRef(null),u=s.useRef(null),[d,h]=s.useState("000000");return s.useLayoutEffect(()=>{if(!x.current)return;const f=x.current.getBoundingClientRect();let y=e+20,v=t+20;y+f.width>o&&(y=e-f.width-20),v+f.height>c&&(v=t-f.height-20),y<0&&(y=0),v<0&&(v=0),a({x:y,y:v})},[o,c,e,t]),s.useEffect(()=>{if(!i||!l.current){u.current=null;return}if(u.current||(u.current=l.current.getContext("2d")),!u.current)return;const f=u.current;f.clearRect(0,0,I,V);const y=i.naturalWidth/o,v=i.naturalHeight/c;f.drawImage(i,e*y-I/2,t*v-V/2,I,V,0,0,I,V);const{data:b}=f.getImageData(Math.floor(I/2),Math.floor(V/2),1,1),z=Array.from(b.slice(0,3)).map(w=>w>=16?w.toString(16):`0${w.toString(16)}`).join("").toUpperCase();h(z)},[o,c,i,e,t]),g.jsxs("div",{ref:x,className:"screenshots-magnifier",style:{transform:`translate(${n==null?void 0:n.x}px, ${n==null?void 0:n.y}px)`},children:[g.jsx("div",{className:"screenshots-magnifier-body",children:g.jsx("canvas",{ref:l,className:"screenshots-magnifier-body-canvas",width:I,height:V})}),g.jsxs("div",{className:"screenshots-magnifier-footer",children:[g.jsxs("div",{className:"screenshots-magnifier-footer-item",children:[r.magnifier_position_label,": (",e,",",t,")"]}),g.jsxs("div",{className:"screenshots-magnifier-footer-item",children:["RGB: #",d]})]})]})});function He({x:e,y:t},{x:o,y:c},i,r){return e>o&&([e,o]=[o,e]),t>c&&([t,c]=[c,t]),e<0&&(e=0),o>i&&(o=i),t<0&&(t=0),c>r&&(c=r),{x:e,y:t,width:o-e,height:c-t}}const Pe=s.memo(function(){const{url:e,image:t,width:o,height:c}=L(),[i,r]=U(),n=s.useRef(null),a=s.useRef(null),x=s.useRef(!1),[l,u]=s.useState(null),d=s.useCallback((f,y)=>{if(!n.current)return;const{x:v,y:b}=n.current.getBoundingClientRect();r.set(He({x:f.x-v,y:f.y-b},{x:y.x-v,y:y.y-b},o,c))},[o,c,r]),h=s.useCallback(f=>{a.current||i||f.button!==0||(a.current={x:f.clientX,y:f.clientY},x.current=!1)},[i]);return s.useEffect(()=>{const f=v=>{if(n.current){const b=n.current.getBoundingClientRect();v.clientX<b.left||v.clientY<b.top||v.clientX>b.right||v.clientY>b.bottom?u(null):u({x:v.clientX-b.x,y:v.clientY-b.y})}a.current&&(d(a.current,{x:v.clientX,y:v.clientY}),x.current=!0)},y=v=>{a.current&&(x.current&&d(a.current,{x:v.clientX,y:v.clientY}),a.current=null,x.current=!1)};return window.addEventListener("mousemove",f),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",y)}},[d]),s.useLayoutEffect(()=>{(!t||i)&&u(null)},[t,i]),!e||!t?null:g.jsxs("div",{ref:n,className:"screenshots-background",onMouseDown:h,children:[g.jsx("img",{className:"screenshots-background-image",src:e}),g.jsx("div",{className:"screenshots-background-mask"}),l&&!i&&g.jsx(Le,{x:l==null?void 0:l.x,y:l==null?void 0:l.y})]})});function A(){const{cursor:e}=L(),{setCursor:t}=te(),o=s.useCallback(i=>{t==null||t(i)},[t]),c=s.useCallback(()=>{t==null||t("move")},[t]);return[e,{set:o,reset:c}]}function J(){const{emiterRef:e}=L(),t=s.useCallback((r,n)=>{const a=e.current;Array.isArray(a[r])?a[r].push(n):a[r]=[n]},[e]),o=s.useCallback((r,n)=>{const a=e.current;if(Array.isArray(a[r])){const x=a[r].findIndex(l=>l===n);x!==-1&&a[r].splice(x,1)}},[e]),c=s.useCallback((r,...n)=>{const a=e.current;Array.isArray(a[r])&&a[r].forEach(x=>x(...n))},[e]),i=s.useCallback(()=>{e.current={}},[e]);return{on:t,off:o,emit:c,reset:i}}function P(){const{history:e}=L(),{setHistory:t}=te(),o=s.useCallback(u=>{const{index:d,stack:h}=e;h.forEach(f=>{f.type===B.Source&&(f.isSelected=!1)}),u.type===B.Source?u.isSelected=!0:u.type===B.Edit&&(u.source.isSelected=!0),h.splice(d+1),h.push(u),t==null||t({index:h.length-1,stack:h})},[e,t]),c=s.useCallback(()=>{const{stack:u}=e;u.pop(),t==null||t({index:u.length-1,stack:u})},[e,t]),i=s.useCallback(()=>{const{index:u,stack:d}=e,h=d[u];h&&(h.type===B.Source?h.isSelected=!1:h.type===B.Edit&&h.source.editHistory.pop()),t==null||t({index:u<=0?-1:u-1,stack:d})},[e,t]),r=s.useCallback(()=>{const{index:u,stack:d}=e,h=d[u+1];h&&(h.type===B.Source?h.isSelected=!1:h.type===B.Edit&&h.source.editHistory.push(h)),t==null||t({index:u>=d.length-1?d.length-1:u+1,stack:d})},[e,t]),n=s.useCallback(u=>{t==null||t({...u})},[t]),a=s.useCallback(u=>{e.stack.forEach(d=>{d.type===B.Source&&(d===u?d.isSelected=!0:d.isSelected=!1)}),t==null||t({...e})},[e,t]),x=s.useCallback(()=>{e.stack.forEach(u=>{u.type===B.Source&&(u.isSelected=!1)}),t==null||t({...e})},[e,t]),l=s.useCallback(()=>{t==null||t({index:-1,stack:[]})},[t]);return[{index:e.index,stack:e.stack,top:e.stack.slice(e.index,e.index+1)[0]},{push:o,pop:c,undo:i,redo:r,set:n,select:a,clearSelect:x,reset:l}]}function W(){const{operation:e}=L(),{setOperation:t}=te(),o=s.useCallback(i=>{t==null||t(i)},[t]),c=s.useCallback(()=>{t==null||t(void 0)},[t]);return[e,{set:o,reset:c}]}function Ye({x:e,y:t},{x:o,y:c},i,r,n,a){return e>o&&([e,o]=[o,e]),t>c&&([t,c]=[c,t]),e<0&&(e=0,a==="move"&&(o=i.width)),o>r&&(o=r,a==="move"&&(e=o-i.width)),t<0&&(t=0,a==="move"&&(c=i.height)),c>n&&(c=n,a==="move"&&(t=c-i.height)),{x:e,y:t,width:Math.max(o-e,1),height:Math.max(c-t,1)}}function Xe(e,t,o,c){const i=e.clientX-o.x,r=e.clientY-o.y;let n=c.x,a=c.y,x=c.x+c.width,l=c.y+c.height;switch(t){case"top":a+=r;break;case"top-right":x+=i,a+=r;break;case"right":x+=i;break;case"right-bottom":x+=i,l+=r;break;case"bottom":l+=r;break;case"bottom-left":n+=i,l+=r;break;case"left":n+=i;break;case"left-top":n+=i,a+=r;break;case"move":n+=i,a+=r,x+=i,l+=r;break}return[{x:n,y:a},{x,y:l}]}function $e(e,t,o,c){if(!t)return!1;const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");if(!r)return!1;const{left:n,top:a}=t.getBoundingClientRect(),x=c.clientX-n,l=c.clientY-a;return[...o.stack.slice(0,o.index+1)].reverse().find(u=>{var d;return u.type!==B.Source?!1:(r.clearRect(0,0,e.width,e.height),(d=u.isHit)==null?void 0:d.call(u,r,u,{x,y:l}))})}const De=["top","right","bottom","left"],Oe=["top","top-right","right","right-bottom","bottom","bottom-left","left","left-top"],Ae=s.memo(s.forwardRef(function(e,t){const{url:o,image:c,width:i,height:r}=L(),n=J(),[a]=P(),[x]=A(),[l,u]=U(),[d]=W(),h=s.useRef(),f=s.useRef(null),y=s.useRef(null),v=s.useRef(null),b=s.useRef(null),z=l&&!a.stack.length&&!d,w=s.useCallback(()=>{if(!l||!b.current)return;const p=b.current;p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="low",p.clearRect(0,0,l.width,l.height),a.stack.slice(0,a.index+1).forEach(C=>{C.type===B.Source&&C.draw(p,C)})},[l,b,a]),j=s.useCallback((p,C)=>{if(!(p.button!==0||!l))if(!d)h.current=C,f.current={x:p.clientX,y:p.clientY},y.current={x:l.x,y:l.y,width:l.width,height:l.height};else{const k=$e(l,v.current,a,p.nativeEvent);k?n.emit("drawselect",k,p.nativeEvent):n.emit("mousedown",p.nativeEvent)}},[l,d,n,a]),m=s.useCallback(p=>{if(!h.current||!f.current||!y.current||!l)return;const C=Xe(p,h.current,f.current,y.current);u.set(Ye(C[0],C[1],l,i,r,h.current))},[i,r,l,u]);return s.useLayoutEffect(()=>{if(!c||!l||!v.current){b.current=null;return}b.current||(b.current=v.current.getContext("2d")),w()},[c,l,w]),s.useEffect(()=>{const p=k=>{if(d)n.emit("mousemove",k);else{if(!h.current||!f.current||!y.current)return;m(k)}},C=k=>{if(d)n.emit("mouseup",k);else{if(!h.current||!f.current||!y.current)return;m(k),h.current=void 0,f.current=null,y.current=null}};return window.addEventListener("mousemove",p),window.addEventListener("mouseup",C),()=>{window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",C)}},[m,d,n]),s.useImperativeHandle(t,()=>b.current),g.jsxs("div",{className:"screenshots-canvas",style:{width:(l==null?void 0:l.width)||0,height:(l==null?void 0:l.height)||0,transform:l?`translate(${l.x}px, ${l.y}px)`:"none"},children:[g.jsxs("div",{className:"screenshots-canvas-body",children:[g.jsx("img",{className:"screenshots-canvas-image",src:o,style:{width:i,height:r,transform:l?`translate(${-l.x}px, ${-l.y}px)`:"none"}}),g.jsx("canvas",{ref:v,className:"screenshots-canvas-panel",width:(l==null?void 0:l.width)||0,height:(l==null?void 0:l.height)||0})]}),g.jsx("div",{className:"screenshots-canvas-mask",style:{cursor:x},onMouseDown:p=>j(p,"move"),children:z&&g.jsxs("div",{className:"screenshots-canvas-size",children:[l.width," × ",l.height]})}),De.map(p=>g.jsx("div",{className:`screenshots-canvas-border-${p}`},p)),z&&Oe.map(p=>g.jsx("div",{className:`screenshots-canvas-point-${p}`,onMouseDown:C=>j(C,p)},p))]})}));function xe(){const e=te();return s.useCallback((t,...o)=>{var c;(c=e.call)==null||c.call(e,t,...o)},[e])}function F(){const{canvasContextRef:e}=L();return e}function pe(){const e=J(),[,t]=U(),[,o]=A(),[,c]=P(),[,i]=W();return s.useCallback(()=>{e.reset(),c.reset(),t.reset(),o.reset(),i.reset()},[e,c,t,o,i])}const We=s.memo(function({open:e,content:t,children:o}){const c=s.useRef(null),i=s.useRef(null),r=s.useRef(null),n=s.useContext(ze),[a,x]=s.useState("bottom"),[l,u]=s.useState(null),[d,h]=s.useState(0),f=()=>(i.current||(i.current=document.createElement("div")),i.current);return s.useEffect(()=>{const y=f();return e&&document.body.appendChild(y),()=>{y.remove()}},[e]),s.useEffect(()=>{if(!e||!n||!c.current||!r.current)return;const y=c.current.getBoundingClientRect(),v=r.current.getBoundingClientRect();let b=a,z=y.left+y.width/2,w=y.top+y.height,j=d;if(z+v.width/2>n.x+n.width){const m=z;z=n.x+n.width-v.width/2,j=m-z}if(z<n.x+v.width/2){const m=z;z=n.x+v.width/2,j=m-z}w>window.innerHeight-v.height&&(b==="bottom"&&(b="top"),w=y.top-v.height),w<0&&(b==="top"&&(b="bottom"),w=y.top+y.height),b!==a&&x(b),((l==null?void 0:l.x)!==z||l.y!==w)&&u({x:z,y:w}),j!==d&&h(j)}),g.jsxs(g.Fragment,{children:[s.cloneElement(o,{ref:c}),e&&t&&ge.createPortal(g.jsxs("div",{ref:r,className:"screenshots-option",style:{visibility:l?"visible":"hidden",transform:`translate(${(l==null?void 0:l.x)??0}px, ${(l==null?void 0:l.y)??0}px)`},"data-placement":a,children:[g.jsx("div",{className:"screenshots-option-container",children:t}),g.jsx("div",{className:"screenshots-option-arrow",style:{marginLeft:d}})]}),f())]})}),Y=s.memo(function({title:e,icon:t,checked:o,disabled:c,option:i,onClick:r}){const n=["screenshots-button"],a=s.useCallback(x=>{c||!r||r(x)},[c,r]);return o&&n.push("screenshots-button-checked"),c&&n.push("screenshots-button-disabled"),g.jsx(We,{open:o,content:i,children:g.jsx("div",{className:n.join(" "),title:e,onClick:a,children:g.jsx("span",{className:t})})})});function Fe(){const{image:e,width:t,height:o,history:c,bounds:i,lang:r}=L(),n=F(),[,a]=P(),x=xe(),l=pe(),u=s.useCallback(()=>{a.clearSelect(),setTimeout(()=>{!n.current||!e||!i||se({image:e,width:t,height:o,history:c,bounds:i}).then(d=>{x("onOk",d,i),l()})})},[n,a,e,t,o,c,i,x,l]);return g.jsx(Y,{title:r.operation_ok_title,icon:"icon-ok",onClick:u})}function Ie(){const e=xe(),t=pe(),o=D(),c=s.useCallback(()=>{e("onCancel"),t()},[e,t]);return g.jsx(Y,{title:o.operation_cancel_title,icon:"icon-cancel",onClick:c})}function Ve(){const{image:e,width:t,height:o,history:c,bounds:i,lang:r}=L(),n=F(),[,a]=P(),x=xe(),l=pe(),u=s.useCallback(()=>{a.clearSelect(),setTimeout(()=>{!n.current||!e||!i||se({image:e,width:t,height:o,history:c,bounds:i}).then(d=>{x("onSave",d,i),l()})})},[n,a,e,t,o,c,i,x,l]);return g.jsx(Y,{title:r.operation_save_title,icon:"icon-save",onClick:u})}function Ue(){const e=D(),[t,o]=P(),c=s.useCallback(()=>{o.redo()},[o]);return g.jsx(Y,{title:e.operation_redo_title,icon:"icon-redo",disabled:!t.stack.length||t.stack.length-1===t.index,onClick:c})}function Je(){const e=D(),[t,o]=P(),c=s.useCallback(()=>{o.undo()},[o]);return g.jsx(Y,{title:e.operation_undo_title,icon:"icon-undo",disabled:t.index===-1,onClick:c})}const Ce=s.memo(function({value:e,onChange:t}){const o=[3,6,9];return g.jsx("div",{className:"screenshots-size",children:o.map(c=>{const i=["screenshots-size-item"];return c===e&&i.push("screenshots-size-active"),g.jsx("div",{className:i.join(" "),onClick:()=>t&&t(c),children:g.jsx("div",{className:"screenshots-size-pointer",style:{width:c*1.8,height:c*1.8}})},c)})})});function Q(e){const t=J();s.useEffect(()=>(t.on("mousedown",e),()=>{t.off("mousedown",e)}),[e,t])}function q(e){const t=J();s.useEffect(()=>(t.on("mousemove",e),()=>{t.off("mousemove",e)}),[e,t])}function G(e){const t=J();s.useEffect(()=>(t.on("mouseup",e),()=>{t.off("mouseup",e)}),[e,t])}function ie(e,t,o){if(!o)return[0,0,0,0];const{data:c,width:i}=o,r=t*i*4+e*4;return Array.from(c.slice(r,r+4))}function Qe(e,t){const{tiles:o,size:c}=t.data;o.forEach(i=>{const r=Math.round(i.color[0]),n=Math.round(i.color[1]),a=Math.round(i.color[2]),x=i.color[3]/255;e.fillStyle=`rgba(${r}, ${n}, ${a}, ${x})`,e.fillRect(i.x-c/2,i.y-c/2,c,c)})}function qe(){const e=D(),{image:t,width:o,height:c}=L(),[i,r]=W(),n=F(),[a,x]=P(),[l]=U(),[,u]=A(),[d,h]=s.useState(3),f=s.useRef(null),y=s.useRef(null),v=i==="Mosaic",b=s.useCallback(()=>{r.set("Mosaic"),u.set("crosshair")},[r,u]),z=s.useCallback(()=>{v||(b(),x.clearSelect())},[v,b,x]),w=s.useCallback(p=>{if(!v||y.current||!f.current||!n.current)return;const C=n.current.canvas.getBoundingClientRect(),k=p.clientX-C.x,S=p.clientY-C.y,E=d*2;y.current={name:"Mosaic",type:B.Source,data:{size:E,tiles:[{x:k,y:S,color:ie(k,S,f.current)}]},editHistory:[],draw:Qe}},[v,d,n]),j=s.useCallback(p=>{if(!v||!y.current||!n.current||!f.current)return;const C=n.current.canvas.getBoundingClientRect(),k=p.clientX-C.x,S=p.clientY-C.y,E=y.current.data.size,_=y.current.data.tiles;let R=_[_.length-1];if(!R)_.push({x:k,y:S,color:ie(k,S,f.current)});else{const oe=R.x-k,M=R.y-S;let H=Math.sqrt(oe**2+M**2);const le=-M/H,ue=-oe/H;for(;H>E;){const K=Math.floor(R.x+E*ue),Z=Math.floor(R.y+E*le);R={x:K,y:Z,color:ie(K,Z,f.current)},_.push(R),H-=E}H>E/2&&_.push({x:k,y:S,color:ie(k,S,f.current)})}a.top!==y.current?x.push(y.current):x.set(a)},[v,n,a,x]),m=s.useCallback(()=>{v&&(y.current=null)},[v]);return Q(w),q(j),G(m),s.useEffect(()=>{if(!l||!t||!v)return;const p=document.createElement("canvas"),C=p.getContext("2d");if(!C)return;p.width=l.width,p.height=l.height;const k=t.naturalWidth/o,S=t.naturalHeight/c;C.drawImage(t,l.x*k,l.y*S,l.width*k,l.height*S,0,0,l.width,l.height),f.current=C.getImageData(0,0,l.width,l.height)},[o,c,l,t,v]),g.jsx(Y,{title:e.operation_mosaic_title,icon:"icon-mosaic",checked:v,onClick:z,option:g.jsx(Ce,{value:d,onChange:h})})}const Ge=s.memo(function({value:e,onChange:t}){const o=["#ee5126","#fceb4d","#90e746","#51c0fa","#7a7a7a","#ffffff"];return g.jsx("div",{className:"screenshots-color",children:o.map(c=>{const i=["screenshots-color-item"];return c===e&&i.push("screenshots-color-active"),g.jsx("div",{className:i.join(" "),style:{backgroundColor:c},onClick:()=>t&&t(c)},c)})})}),ne=s.memo(function({size:e,color:t,onSizeChange:o,onColorChange:c}){return g.jsxs("div",{className:"screenshots-sizecolor",children:[g.jsx(Ce,{value:e,onChange:o}),g.jsx(Ge,{value:t,onChange:c})]})}),Ke=`
min-width: 0 !important;
width: 0 !important;
min-height: 0 !important;
height:0 !important;
visibility: hidden !important;
overflow: hidden !important;
position: absolute !important;
z-index: -1000 !important;
top:0 !important;
right:0 !important;
`,Ze=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","text-indent","padding-left","padding-right","border-width","box-sizing","white-space","word-break"];let O;function et(e){const t=window.getComputedStyle(e),o=t.getPropertyValue("box-sizing")||t.getPropertyValue("-moz-box-sizing")||t.getPropertyValue("-webkit-box-sizing"),c=parseFloat(t.getPropertyValue("padding-bottom"))+parseFloat(t.getPropertyValue("padding-top")),i=parseFloat(t.getPropertyValue("border-bottom-width"))+parseFloat(t.getPropertyValue("border-top-width"));return{sizingStyle:Ze.map(r=>`${r}:${t.getPropertyValue(r)}`).join(";"),paddingSize:c,borderSize:i,boxSizing:o}}function tt(e,t,o,c){O||(O=document.createElement("textarea"),O.setAttribute("tab-index","-1"),document.body.appendChild(O));const{paddingSize:i,borderSize:r,boxSizing:n,sizingStyle:a}=et(e);O.setAttribute("style",`${a};${Ke};max-width:${o}px;max-height:${c}px`),O.value=t||" ";let x=O.scrollWidth,l=O.scrollHeight;return n==="border-box"?(x+=r,l+=r):n==="content-box"&&(x-=i,l-=i),{width:Math.min(x,o),height:Math.min(l,c)}}const nt=s.memo(function({x:e,y:t,maxWidth:o,maxHeight:c,size:i,color:r,value:n,onChange:a,onBlur:x}){const l=s.useRef(null),u=s.useRef(null),[d,h]=s.useState(0),[f,y]=s.useState(0),v=()=>(l.current||(l.current=document.createElement("div")),l.current);return s.useLayoutEffect(()=>(l.current&&(document.body.appendChild(l.current),requestAnimationFrame(()=>{var b;(b=u.current)==null||b.focus()})),()=>{var b;(b=l.current)==null||b.remove()}),[]),s.useLayoutEffect(()=>{if(!u.current)return;const{width:b,height:z}=tt(u.current,n,o,c);h(b),y(z)},[n,o,c]),ge.createPortal(g.jsx("textarea",{ref:u,className:"screenshots-textarea",style:{color:r,width:d,height:f,maxWidth:o,maxHeight:c,fontSize:i,lineHeight:`${i}px`,transform:`translate(${e}px, ${t}px)`},value:n,onChange:b=>a&&a(b.target.value),onBlur:b=>x&&x(b)}),v())});function re(e){const t=J();s.useEffect(()=>(t.on("drawselect",e),()=>{t.off("drawselect",e)}),[e,t])}const de={3:18,6:32,9:46};function rt(e,t){const{size:o,color:c,fontFamily:i,x:r,y:n,text:a}=t.data;e.fillStyle=c,e.textAlign="left",e.textBaseline="top",e.font=`${o}px ${i}`;const x=t.editHistory.reduce((l,{data:u})=>({x:l.x+u.x2-u.x1,y:l.y+u.y2-u.y1}),{x:0,y:0});a.split(`
`).forEach((l,u)=>{e.fillText(l,r+x.x,n+x.y+u*o)})}function ot(e,t,o){e.textAlign="left",e.textBaseline="top",e.font=`${t.data.size}px ${t.data.fontFamily}`;let c=0,i=0;t.data.text.split(`
`).forEach(d=>{const h=e.measureText(d);c<h.width&&(c=h.width),i+=t.data.size});const{x:r,y:n}=t.editHistory.reduce((d,{data:h})=>({x:d.x+h.x2-h.x1,y:d.y+h.y2-h.y1}),{x:0,y:0}),a=t.data.x+r,x=t.data.y+n,l=a+c,u=x+i;return o.x>=a&&o.x<=l&&o.y>=x&&o.y<=u}function it(){const e=D(),[t,o]=P(),[c]=U(),[i,r]=W(),[,n]=A(),a=F(),[x,l]=s.useState(3),[u,d]=s.useState("#ee5126"),h=s.useRef(null),f=s.useRef(null),[y,v]=s.useState(null),[b,z]=s.useState(""),w=i==="Text",j=s.useCallback(()=>{r.set("Text"),n.set("default")},[r,n]),m=s.useCallback(()=>{w||(j(),o.clearSelect())},[w,j,o]),p=s.useCallback(M=>{h.current&&(h.current.data.size=de[M]),l(M)},[]),C=s.useCallback(M=>{h.current&&(h.current.data.color=M),d(M)},[]),k=s.useCallback(M=>{z(M),w&&h.current&&(h.current.data.text=M)},[w]),S=s.useCallback(()=>{h.current&&h.current.data.text&&o.push(h.current),h.current=null,z(""),v(null)},[o]),E=s.useCallback((M,H)=>{M.name==="Text"&&(j(),f.current={type:B.Edit,data:{x1:H.clientX,y1:H.clientY,x2:H.clientX,y2:H.clientY},source:M},o.select(M))},[j,o]),_=s.useCallback(M=>{if(!w||!a.current||h.current||!c)return;const{left:H,top:le}=a.current.canvas.getBoundingClientRect(),ue=window.getComputedStyle(a.current.canvas).fontFamily,K=M.clientX-H,Z=M.clientY-le;h.current={name:"Text",type:B.Source,data:{size:de[x],color:u,fontFamily:ue,x:K,y:Z,text:""},editHistory:[],draw:rt,isHit:ot},v({x:M.clientX,y:M.clientY,maxWidth:c.width-K,maxHeight:c.height-Z})},[w,x,u,c,a]),R=s.useCallback(M=>{w&&f.current&&(f.current.data.x2=M.clientX,f.current.data.y2=M.clientY,t.top!==f.current?(f.current.source.editHistory.push(f.current),o.push(f.current)):o.set(t))},[w,t,o]),oe=s.useCallback(()=>{w&&(f.current=null)},[w]);return re(E),Q(_),q(R),G(oe),g.jsxs(g.Fragment,{children:[g.jsx(Y,{title:e.operation_text_title,icon:"icon-text",checked:w,onClick:m,option:g.jsx(ne,{size:x,color:u,onSizeChange:p,onColorChange:C})}),w&&y&&g.jsx(nt,{x:y.x,y:y.y,maxWidth:y.maxWidth,maxHeight:y.maxHeight,size:de[x],color:u,value:b,onChange:k,onBlur:S})]})}const ke=4;function T(e,t,o){e.lineWidth=1,e.strokeStyle="#000000",e.fillStyle="#ffffff",e.beginPath(),e.arc(t,o,ke,0,2*Math.PI),e.fill(),e.stroke()}function ae(e,t,o){t.draw(e,t);const{data:c}=e.getImageData(o.x,o.y,1,1);return c.some(i=>i!==0)}function N(e,t,o){if(!e)return!1;const{left:c,top:i}=e.getBoundingClientRect(),r=t.clientX-c,n=t.clientY-i;return(o.x-r)**2+(o.y-n)**2<ke**2}function ct(e,t){const{size:o,color:c,points:i}=t.data;e.lineCap="round",e.lineJoin="round",e.lineWidth=o,e.strokeStyle=c;const r=t.editHistory.reduce((n,{data:a})=>({x:n.x+a.x2-a.x1,y:n.y+a.y2-a.y1}),{x:0,y:0});e.beginPath(),i.forEach((n,a)=>{a===0?e.moveTo(n.x+r.x,n.y+r.y):e.lineTo(n.x+r.x,n.y+r.y)}),e.stroke(),t.isSelected&&(e.lineWidth=1,e.strokeStyle="#000000",e.beginPath(),i.forEach((n,a)=>{a===0?e.moveTo(n.x+r.x,n.y+r.y):e.lineTo(n.x+r.x,n.y+r.y)}),e.stroke())}function st(){const e=D(),[,t]=A(),[o,c]=W(),i=F(),[r,n]=P(),[a,x]=s.useState(3),[l,u]=s.useState("#ee5126"),d=s.useRef(null),h=s.useRef(null),f=o==="Brush",y=s.useCallback(()=>{c.set("Brush"),t.set("default")},[c,t]),v=s.useCallback(()=>{f||(y(),n.clearSelect())},[f,y,n]),b=s.useCallback((m,p)=>{m.name==="Brush"&&(y(),h.current={type:B.Edit,data:{x1:p.clientX,y1:p.clientY,x2:p.clientX,y2:p.clientY},source:m},n.select(m))},[y,n]),z=s.useCallback(m=>{if(!f||d.current||!i.current)return;const{left:p,top:C}=i.current.canvas.getBoundingClientRect();d.current={name:"Brush",type:B.Source,data:{size:a,color:l,points:[{x:m.clientX-p,y:m.clientY-C}]},editHistory:[],draw:ct,isHit:ae}},[f,i,a,l]),w=s.useCallback(m=>{if(!(!f||!i.current)){if(h.current)h.current.data.x2=m.clientX,h.current.data.y2=m.clientY,r.top!==h.current?(h.current.source.editHistory.push(h.current),n.push(h.current)):n.set(r);else if(d.current){const{left:p,top:C}=i.current.canvas.getBoundingClientRect();d.current.data.points.push({x:m.clientX-p,y:m.clientY-C}),r.top!==d.current?n.push(d.current):n.set(r)}}},[f,r,i,n]),j=s.useCallback(()=>{f&&(d.current&&n.clearSelect(),d.current=null,h.current=null)},[f,n]);return re(b),Q(z),q(w),G(j),g.jsx(Y,{title:e.operation_brush_title,icon:"icon-brush",checked:f,onClick:v,option:g.jsx(ne,{size:a,color:l,onSizeChange:x,onColorChange:u})})}function we(e){let{x1:t,y1:o,x2:c,y2:i}=e.data;return e.editHistory.forEach(({data:r})=>{const n=r.x2-r.x1,a=r.y2-r.y1;r.type===ce.Move?(t+=n,o+=a,c+=n,i+=a):r.type===ce.MoveStart?(t+=n,o+=a):r.type===ce.MoveEnd&&(c+=n,i+=a)}),{...e.data,x1:t,x2:c,y1:o,y2:i}}function at(e,t){const{size:o,color:c,x1:i,x2:r,y1:n,y2:a}=we(t);e.lineCap="round",e.lineJoin="bevel",e.lineWidth=o,e.strokeStyle=c;const x=r-i,l=a-n,u=o*3,d=Math.atan2(l,x);e.beginPath(),e.moveTo(i,n),e.lineTo(r,a),e.lineTo(r-u*Math.cos(d-Math.PI/6),a-u*Math.sin(d-Math.PI/6)),e.moveTo(r,a),e.lineTo(r-u*Math.cos(d+Math.PI/6),a-u*Math.sin(d+Math.PI/6)),e.stroke(),t.isSelected&&(T(e,i,n),T(e,r,a))}var ce=(e=>(e[e.Move=0]="Move",e[e.MoveStart=1]="MoveStart",e[e.MoveEnd=2]="MoveEnd",e))(ce||{});function lt(){const e=D(),[,t]=A(),[o,c]=W(),[i,r]=P(),n=F(),[a,x]=s.useState(3),[l,u]=s.useState("#ee5126"),d=s.useRef(null),h=s.useRef(null),f=o==="Arrow",y=s.useCallback(()=>{c.set("Arrow"),t.set("default")},[c,t]),v=s.useCallback(()=>{f||(y(),r.clearSelect())},[f,y,r]),b=s.useCallback((m,p)=>{if(m.name!=="Arrow"||!n.current)return;const C=m;y();const{x1:k,y1:S,x2:E,y2:_}=we(C);let R=0;N(n.current.canvas,p,{x:k,y:S})?R=1:N(n.current.canvas,p,{x:E,y:_})&&(R=2),h.current={type:B.Edit,data:{type:R,x1:p.clientX,y1:p.clientY,x2:p.clientX,y2:p.clientY},source:C},r.select(m)},[n,y,r]),z=s.useCallback(m=>{if(!f||d.current||!n.current)return;const{left:p,top:C}=n.current.canvas.getBoundingClientRect();d.current={name:"Arrow",type:B.Source,data:{size:a,color:l,x1:m.clientX-p,y1:m.clientY-C,x2:m.clientX-p,y2:m.clientY-C},editHistory:[],draw:at,isHit:ae}},[f,l,a,n]),w=s.useCallback(m=>{if(!(!f||!n.current)){if(h.current)h.current.data.x2=m.clientX,h.current.data.y2=m.clientY,i.top!==h.current?(h.current.source.editHistory.push(h.current),r.push(h.current)):r.set(i);else if(d.current){const{left:p,top:C}=n.current.canvas.getBoundingClientRect();d.current.data.x2=m.clientX-p,d.current.data.y2=m.clientY-C,i.top!==d.current?r.push(d.current):r.set(i)}}},[f,i,n,r]),j=s.useCallback(()=>{f&&(d.current&&r.clearSelect(),d.current=null,h.current=null)},[f,r]);return re(b),Q(z),q(w),G(j),g.jsx(Y,{title:e.operation_arrow_title,icon:"icon-arrow",checked:f,onClick:v,option:g.jsx(ne,{size:a,color:l,onSizeChange:x,onColorChange:u})})}function Se(e){let{x1:t,y1:o,x2:c,y2:i}=e.data;return e.editHistory.forEach(({data:r})=>{const n=r.x2-r.x1,a=r.y2-r.y1;r.type===X.Move?(t+=n,o+=a,c+=n,i+=a):r.type===X.ResizeTop?o+=a:r.type===X.ResizeRightTop?(c+=n,o+=a):r.type===X.ResizeRight?c+=n:r.type===X.ResizeRightBottom?(c+=n,i+=a):r.type===X.ResizeBottom?i+=a:r.type===X.ResizeLeftBottom?(t+=n,i+=a):r.type===X.ResizeLeft?t+=n:r.type===X.ResizeLeftTop&&(t+=n,o+=a)}),{...e.data,x1:t,x2:c,y1:o,y2:i}}function ut(e,t){const{size:o,color:c,x1:i,y1:r,x2:n,y2:a}=Se(t);e.lineCap="butt",e.lineJoin="miter",e.lineWidth=o,e.strokeStyle=c;const x=(i+n)/2,l=(r+a)/2,u=Math.abs(n-i)/2,d=Math.abs(a-r)/2,h=.5522848,f=u*h,y=d*h;e.beginPath(),e.moveTo(x-u,l),e.bezierCurveTo(x-u,l-y,x-f,l-d,x,l-d),e.bezierCurveTo(x+f,l-d,x+u,l-y,x+u,l),e.bezierCurveTo(x+u,l+y,x+f,l+d,x,l+d),e.bezierCurveTo(x-f,l+d,x-u,l+y,x-u,l),e.closePath(),e.stroke(),t.isSelected&&(e.lineWidth=1,e.strokeStyle="#000000",e.fillStyle="#ffffff",e.beginPath(),e.moveTo(i,r),e.lineTo(n,r),e.lineTo(n,a),e.lineTo(i,a),e.closePath(),e.stroke(),T(e,(i+n)/2,r),T(e,n,r),T(e,n,(r+a)/2),T(e,n,a),T(e,(i+n)/2,a),T(e,i,a),T(e,i,(r+a)/2),T(e,i,r))}var X=(e=>(e[e.Move=0]="Move",e[e.ResizeTop=1]="ResizeTop",e[e.ResizeRightTop=2]="ResizeRightTop",e[e.ResizeRight=3]="ResizeRight",e[e.ResizeRightBottom=4]="ResizeRightBottom",e[e.ResizeBottom=5]="ResizeBottom",e[e.ResizeLeftBottom=6]="ResizeLeftBottom",e[e.ResizeLeft=7]="ResizeLeft",e[e.ResizeLeftTop=8]="ResizeLeftTop",e))(X||{});function dt(){const e=D(),[t,o]=P(),[c,i]=W(),[,r]=A(),n=F(),[a,x]=s.useState(3),[l,u]=s.useState("#ee5126"),d=s.useRef(null),h=s.useRef(null),f=c==="Ellipse",y=s.useCallback(()=>{i.set("Ellipse"),r.set("crosshair")},[i,r]),v=s.useCallback(()=>{f||(y(),o.clearSelect())},[f,y,o]),b=s.useCallback((m,p)=>{if(m.name!=="Ellipse"||!n.current)return;const C=m;y();const{x1:k,y1:S,x2:E,y2:_}=Se(C);let R=0;N(n.current.canvas,p,{x:(k+E)/2,y:S})?R=1:N(n.current.canvas,p,{x:E,y:S})?R=2:N(n.current.canvas,p,{x:E,y:(S+_)/2})?R=3:N(n.current.canvas,p,{x:E,y:_})?R=4:N(n.current.canvas,p,{x:(k+E)/2,y:_})?R=5:N(n.current.canvas,p,{x:k,y:_})?R=6:N(n.current.canvas,p,{x:k,y:(S+_)/2})?R=7:N(n.current.canvas,p,{x:k,y:S})&&(R=8),h.current={type:B.Edit,data:{type:R,x1:p.clientX,y1:p.clientY,x2:p.clientX,y2:p.clientY},source:C},o.select(m)},[n,y,o]),z=s.useCallback(m=>{if(!f||!n.current||d.current)return;const{left:p,top:C}=n.current.canvas.getBoundingClientRect(),k=m.clientX-p,S=m.clientY-C;d.current={name:"Ellipse",type:B.Source,data:{size:a,color:l,x1:k,y1:S,x2:k,y2:S},editHistory:[],draw:ut,isHit:ae}},[f,a,l,n]),w=s.useCallback(m=>{if(!(!f||!n.current)){if(h.current)h.current.data.x2=m.clientX,h.current.data.y2=m.clientY,t.top!==h.current?(h.current.source.editHistory.push(h.current),o.push(h.current)):o.set(t);else if(d.current){const{left:p,top:C}=n.current.canvas.getBoundingClientRect();d.current.data.x2=m.clientX-p,d.current.data.y2=m.clientY-C,t.top!==d.current?o.push(d.current):o.set(t)}}},[f,n,t,o]),j=s.useCallback(()=>{f&&(d.current&&o.clearSelect(),d.current=null,h.current=null)},[f,o]);return re(b),Q(z),q(w),G(j),g.jsx(Y,{title:e.operation_ellipse_title,icon:"icon-ellipse",checked:f,onClick:v,option:g.jsx(ne,{size:a,color:l,onSizeChange:x,onColorChange:u})})}function Re(e){let{x1:t,y1:o,x2:c,y2:i}=e.data;return e.editHistory.forEach(({data:r})=>{const n=r.x2-r.x1,a=r.y2-r.y1;r.type===$.Move?(t+=n,o+=a,c+=n,i+=a):r.type===$.ResizeTop?o+=a:r.type===$.ResizeRightTop?(c+=n,o+=a):r.type===$.ResizeRight?c+=n:r.type===$.ResizeRightBottom?(c+=n,i+=a):r.type===$.ResizeBottom?i+=a:r.type===$.ResizeLeftBottom?(t+=n,i+=a):r.type===$.ResizeLeft?t+=n:r.type===$.ResizeLeftTop&&(t+=n,o+=a)}),{...e.data,x1:t,x2:c,y1:o,y2:i}}function ht(e,t){const{size:o,color:c,x1:i,y1:r,x2:n,y2:a}=Re(t);e.lineCap="butt",e.lineJoin="miter",e.lineWidth=o,e.strokeStyle=c,e.beginPath(),e.moveTo(i,r),e.lineTo(n,r),e.lineTo(n,a),e.lineTo(i,a),e.closePath(),e.stroke(),t.isSelected&&(e.lineWidth=1,e.strokeStyle="#000000",e.fillStyle="#ffffff",T(e,(i+n)/2,r),T(e,n,r),T(e,n,(r+a)/2),T(e,n,a),T(e,(i+n)/2,a),T(e,i,a),T(e,i,(r+a)/2),T(e,i,r))}var $=(e=>(e[e.Move=0]="Move",e[e.ResizeTop=1]="ResizeTop",e[e.ResizeRightTop=2]="ResizeRightTop",e[e.ResizeRight=3]="ResizeRight",e[e.ResizeRightBottom=4]="ResizeRightBottom",e[e.ResizeBottom=5]="ResizeBottom",e[e.ResizeLeftBottom=6]="ResizeLeftBottom",e[e.ResizeLeft=7]="ResizeLeft",e[e.ResizeLeftTop=8]="ResizeLeftTop",e))($||{});function ft(){const e=D(),[t,o]=P(),[c,i]=W(),[,r]=A(),n=F(),[a,x]=s.useState(3),[l,u]=s.useState("#ee5126"),d=s.useRef(null),h=s.useRef(null),f=c==="Rectangle",y=s.useCallback(()=>{i.set("Rectangle"),r.set("crosshair")},[i,r]),v=s.useCallback(()=>{f||(y(),o.clearSelect())},[f,y,o]),b=s.useCallback((m,p)=>{if(m.name!=="Rectangle"||!n.current)return;const C=m;y();const{x1:k,y1:S,x2:E,y2:_}=Re(C);let R=0;N(n.current.canvas,p,{x:(k+E)/2,y:S})?R=1:N(n.current.canvas,p,{x:E,y:S})?R=2:N(n.current.canvas,p,{x:E,y:(S+_)/2})?R=3:N(n.current.canvas,p,{x:E,y:_})?R=4:N(n.current.canvas,p,{x:(k+E)/2,y:_})?R=5:N(n.current.canvas,p,{x:k,y:_})?R=6:N(n.current.canvas,p,{x:k,y:(S+_)/2})?R=7:N(n.current.canvas,p,{x:k,y:S})&&(R=8),h.current={type:B.Edit,data:{type:R,x1:p.clientX,y1:p.clientY,x2:p.clientX,y2:p.clientY},source:m},o.select(m)},[n,y,o]),z=s.useCallback(m=>{if(!f||!n.current||d.current)return;const{left:p,top:C}=n.current.canvas.getBoundingClientRect(),k=m.clientX-p,S=m.clientY-C;d.current={name:"Rectangle",type:B.Source,data:{size:a,color:l,x1:k,y1:S,x2:k,y2:S},editHistory:[],draw:ht,isHit:ae}},[f,a,l,n]),w=s.useCallback(m=>{if(!(!f||!n.current)){if(h.current)h.current.data.x2=m.clientX,h.current.data.y2=m.clientY,t.top!==h.current?(h.current.source.editHistory.push(h.current),o.push(h.current)):o.set(t);else if(d.current){const{left:p,top:C}=n.current.canvas.getBoundingClientRect(),k=d.current.data;k.x2=m.clientX-p,k.y2=m.clientY-C,t.top!==d.current?o.push(d.current):o.set(t)}}},[f,n,t,o]),j=s.useCallback(()=>{f&&(d.current&&o.clearSelect(),d.current=null,h.current=null)},[f,o]);return re(b),Q(z),q(w),G(j),g.jsx(Y,{title:e.operation_rectangle_title,icon:"icon-rectangle",checked:f,onClick:v,option:g.jsx(ne,{size:a,color:l,onSizeChange:x,onColorChange:u})})}const xt=[ft,dt,lt,st,it,qe,"|",Je,Ue,"|",Ve,Ie,Fe],ze=he.createContext(null),pt=s.memo(function(){const{width:e,height:t}=L(),[o]=U(),[c,i]=s.useState(null),[r,n]=s.useState(null),a=s.useRef(null),x=s.useCallback(u=>{u.stopPropagation()},[]),l=s.useCallback(u=>{u.preventDefault(),u.stopPropagation()},[]);return s.useEffect(()=>{if(!o||!a.current)return;const u=a.current.getBoundingClientRect();let d=o.x+o.width-u.width,h=o.y+o.height+10;d<0&&(d=0),d>e-u.width&&(d=e-u.width),h>t-u.height&&(h=t-u.height-10),(!r||Math.abs(r.x-d)>1||Math.abs(r.y-h)>1)&&n({x:d,y:h}),(!c||Math.abs(c.x-u.x)>1||Math.abs(c.y-u.y)>1||Math.abs(c.width-u.width)>1||Math.abs(c.height-u.height)>1)&&i({x:u.x,y:u.y,width:u.width,height:u.height})}),o?g.jsx(ze.Provider,{value:c,children:g.jsx("div",{ref:a,className:"screenshots-operations",style:{visibility:r?"visible":"hidden",transform:`translate(${(r==null?void 0:r.x)??0}px, ${(r==null?void 0:r.y)??0}px)`},onDoubleClick:x,onContextMenu:l,children:g.jsx("div",{className:"screenshots-operations-buttons",children:xt.map((u,d)=>u==="|"?g.jsx("div",{className:"screenshots-operations-divider"},d):g.jsx(u,{},d))})})}):null});function yt(e){const[t,o]=s.useState(null);return s.useEffect(()=>{if(o(null),e==null)return;const c=document.createElement("img"),i=()=>o(c),r=()=>o(null);return c.addEventListener("load",i),c.addEventListener("error",r),c.src=e,()=>{c.removeEventListener("load",i),c.removeEventListener("error",r)}},[e]),t}function mt({url:e,width:t,height:o,lang:c,className:i,...r}){const n=yt(e),a=s.useRef(null),x=s.useRef({}),[l,u]=s.useState({index:-1,stack:[]}),[d,h]=s.useState(null),[f,y]=s.useState("move"),[v,b]=s.useState(void 0),z={url:e,width:t,height:o,image:n,lang:{...be,...c},emiterRef:x,canvasContextRef:a,history:l,bounds:d,cursor:f,operation:v},w=s.useCallback((S,...E)=>{const _=r[S];typeof _=="function"&&_(...E)},[r]),j={call:w,setHistory:u,setBounds:h,setCursor:y,setOperation:b},m=["screenshots"];i&&m.push(i);const p=()=>{x.current={},u({index:-1,stack:[]}),h(null),y("move"),b(void 0)},C=s.useCallback(async S=>{if(!(S.button!==0||!n))if(d&&a.current)se({image:n,width:t,height:o,history:l,bounds:d}).then(E=>{w("onOk",E,d),p()});else{const E={x:0,y:0,width:t,height:o};se({image:n,width:t,height:o,history:l,bounds:E}).then(_=>{w("onOk",_,E),p()})}},[n,l,d,t,o,w]),k=s.useCallback(S=>{S.button===2&&(S.preventDefault(),w("onCancel"),p())},[w]);return s.useLayoutEffect(()=>{p()},[e]),g.jsx(fe.Provider,{value:{store:z,dispatcher:j},children:g.jsxs("div",{className:m.join(" "),style:{width:t,height:o},onDoubleClick:C,onContextMenu:k,children:[g.jsx(Pe,{}),g.jsx(Ae,{ref:a}),g.jsx(pt,{})]})})}const gt="/pear-rec/imgs/th.webp";function vt(){const e=s.useCallback((c,i)=>{if(console.log("save",c,i),c){const r=URL.createObjectURL(c);console.log(r),window.open(r)}},[]),t=s.useCallback(()=>{console.log("cancel")},[]),o=s.useCallback((c,i)=>{if(console.log("ok",c,i),c){const r=URL.createObjectURL(c);console.log(r),window.open(r)}},[]);return ye("div",{className:"body",children:ye(mt,{url:gt,width:window.innerWidth,height:window.innerHeight,lang:{operation_rectangle_title:"Rectangle"},onSave:e,onCancel:t,onOk:o})})}const wt=JSON.parse('{"title":"","description":"","frontmatter":{"layout":false},"headers":[],"relativePath":"screenshot/demo.md","filePath":"screenshot/demo.md"}'),bt={name:"screenshot/demo.md"},St=Object.assign(bt,{setup(e){const t=_e();return je(()=>{Ee(t.value).render(s.createElement(vt,{},null))}),(o,c)=>(Be(),Me("div",null,[Te("div",{ref_key:"el",ref:t,id:"root"},null,512)]))}});export{wt as __pageData,St as default};
